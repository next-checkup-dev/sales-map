# 주소 정규화 스크립트

변환 실패한 주소를 자동으로 정규화하여 다시 변환을 시도하는 Python 스크립트입니다.

## 기능

- E열에 '변환실패'로 기록된 행들을 자동으로 찾습니다
- 해당 행의 D열 주소를 정규화 규칙에 따라 수정합니다
- 정규화된 주소로 다시 위도/경도 변환을 시도합니다
- 성공한 경우 E, F열에 좌표를 업데이트합니다

## 정규화 규칙

다음과 같은 패턴들을 자동으로 정리합니다:

1. **괄호 제거**: `(임당동, 유암빌딩)` → 제거
2. **쉼표 이후 내용 제거**: `, 2~5층` → 제거
3. **층수 정보 제거**: `2층`, `3~5층` → 제거
4. **건물명 제거**: `유암빌딩`, `○○건물` → 제거
5. **상세 주소 제거**: `1동`, `101호` → 제거

## 예시

**원본 주소**: `강원특별자치도 강릉시 경강로 2079, 2~5층(임당동, 유암빌딩)`

**정규화 후**: `강원특별자치도 강릉시 경강로 2079`

## 사용법

### 1. 설정 수정

`address_normalizer.py` 파일에서 다음 값들을 실제 값으로 수정하세요:

```python
KAKAO_API_KEY = "실제_카카오_API_키"
SPREADSHEET_ID = "실제_스프레드시트_ID"
SHEET_NAME = "실제_시트_이름"
```

### 2. 스크립트 실행

```bash
python3 address_normalizer.py
```

### 3. 실행 결과

```
주소 정규화 및 재변환 스크립트 시작
구글 API 인증 성공
총 100행의 데이터를 확인합니다.
행 15: 주소 정규화 시도
  원본: 강원특별자치도 강릉시 경강로 2079, 2~5층(임당동, 유암빌딩)
  정규화: 강원특별자치도 강릉시 경강로 2079
  → 성공: 위도 37.7519, 경도 128.8765
행 23: 주소 정규화 시도
  원본: 서울시 강남구 테헤란로 123, 4층(역삼동, 테헤란빌딩)
  정규화: 서울시 강남구 테헤란로 123
  → 성공: 위도 37.5665, 경도 126.9780

총 2개의 주소가 정규화 후 변환 성공했습니다.
구글 시트에 업데이트 중...
행 15 업데이트 완료
행 23 업데이트 완료
모든 작업이 완료되었습니다!
```

## 주의사항

1. **기존 스크립트 실행 후 사용**: 먼저 `geocoding_script.py`로 초기 변환을 실행한 후 사용하세요.

2. **API 호출 제한**: 카카오 API 호출 제한을 준수하기 위해 0.1초 간격으로 처리합니다.

3. **정규화 규칙**: 필요에 따라 `AddressNormalizer` 클래스의 `normalization_rules`를 수정할 수 있습니다.

4. **안전성**: 원본 주소(D열)는 변경하지 않고, 정규화된 주소로만 변환을 시도합니다.

## 정규화 규칙 추가/수정

새로운 정규화 규칙을 추가하려면 `AddressNormalizer` 클래스의 `normalization_rules` 리스트에 추가하세요:

```python
self.normalization_rules = [
    # 기존 규칙들...
    
    # 새로운 규칙 추가
    (r'새로운_패턴', '대체_텍스트'),
    (r'복잡한_패턴', lambda m: m.group(1) + '수정된_텍스트'),
]
```

## 오류 해결

### 정규화 후에도 실패하는 경우
- 주소가 너무 구체적이거나 모호한 경우
- 실제로 존재하지 않는 주소인 경우
- 카카오 지도 API에서 인식하지 못하는 주소 형식인 경우

### 구글 시트 업데이트 실패
- 서비스 계정 권한 확인
- 스프레드시트 ID와 시트 이름 확인
- 네트워크 연결 상태 확인 